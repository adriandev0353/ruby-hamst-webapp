<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">

  <div class="navbar-brand-custom">
    <%- if registerInProgress %>
    <div class="float-left navbar-brand-text-only" href="#">Hamster Nest</div>
    <%- else %>
    <%= link_to root_path do %>
    <div id="hamster-nest" class="float-left navbar-brand-text">Hamster Nest</div>
    <% end %>
    <% end %>
  </div>

  <%- if user_signed_in? && !registerInProgress %>
  <%= render "items/item_search_box" %>
  <% else %>
  <div class="container" id="search-box">
  </div>
  <% end %>

  <button id="navi-hide" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>


  <div class="float-right" id="navbarResponsive">
    <ul class="navbar-nav">
      <%- if registerInProgress %>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              My Account
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              <%= link_to "Add profile", edit_user_profile_path(current_user.id),:class => "dropdown-item" %>
              <%= link_to "Log Out", destroy_user_session_path, method: :delete, :class => "dropdown-item" %>
            </div>
          </li>
        </ul>
      </div>
      <%- elsif !user_signed_in? %>
      <li class="nav-item">
          <%= link_to 'Register', new_user_registration_path, :id => "register", :class => "btn btn-link" %><br>
      </li>
      <li class="nav-item">
        <%= link_to 'Sign In', new_user_session_path, :class => "btn btn-light" %><br>
      </li>
      <%- else %>
      <li class="nav-item dropdown">
        <%= link_to 'New item', new_user_profile_item_path(current_user.id), class: "btn btn-info"  %>
      </li>
    <% if @new_message %>
      <li class="nav-item dropdown">
      <span class="notify-badge"><%=@message_num%></span>
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Message!
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

        <% @new_requests.each do |req_id|%>
          <% @new_req = BorrowRequest.find(req_id)%>
          <% if @new_req.user_profile.id!= current_user.id%>
          <%= link_to @new_req.item.item_name, item_borrow_request_path(:item_id=>@new_req.item.id, :id=>req_id, :read_status=>true), :method=> :put, :class => "dropdown-item"  %>
          <%else%>
          <%= link_to @new_req.item.item_name, item_borrow_request_path(:item_id=>@new_req.item.id, :id=>req_id), :class => "dropdown-item"  %>
          <%end%>
        <%end%>
        </div>
      </li>
    <%end%>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          My Lists
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <%= link_to "My items", user_profile_items_path(:user_profile_id =>current_user.user_profile_id), :class => "dropdown-item" %>
          <%= link_to "Borrow list", borrow_from_others_path(), :class => "dropdown-item" %>
          <%= link_to "Lend list", lend_to_others_path, :class => "dropdown-item"  %>
        </div>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          My Account
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
          <%= link_to "View my profile", user_profile_path(current_user.user_profile_id), :class => "dropdown-item" %>

          <%= link_to "Log Out", destroy_user_session_path, method: :delete, :class => "dropdown-item" %>
        </div>
      </li>
      <% end %>
    </ul>
  </div>

</nav>
